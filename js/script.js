const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),numRows=16,numCols=32,tileWidth=16,tileHeight=16;let loadone=!1,selectedBuildingIndex=-1;const alerts=document.getElementById("altmsg");let unlck=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];const itemsCosts=[15,20,25,30,40,60,10,20,30,40,60,10,50,100];let Op=[0,0],Op2=[0,0,0,0,0,0,0,0,0,0,0],CoinsCurrency=10;const yr=document.getElementById("yr"),mnth=document.getElementById("mnth");let tsell=0;const sellAllButton=document.getElementById("sellall"),tsellbtn=document.getElementById("tsell"),cityData=Array.from({length:16},()=>Array.from({length:32},()=>0)),water=new Image;water.src="assets/water.jpg";const grass=new Image;grass.src="assets/grass.jpg";const grass2=new Image;grass2.src="assets/grass2.png";const house=new Image;house.src="assets/house.png";const road=new Image;road.src="assets/road.png";const factory=new Image;factory.src="assets/factory.png";const farm=new Image;farm.src="assets/farm.jpg";const wind1=new Image;wind1.src="assets/wind1.png";const wind2=new Image;wind2.src="assets/wind2.png";const TownHall=new Image;TownHall.src="assets/TownHall.png";const Mine=new Image;Mine.src="assets/Mine.png";const ware=new Image;ware.src="assets/warehouse.png";const Fisry=new Image;Fisry.src="assets/fishery.png";const park=new Image;park.src="assets/park.png";const baseT=new Image;baseT.src="assets/base.png";const UpperT=new Image;UpperT.src="assets/Upper.png";const buildingImages={0:grass,.5:grass2,1:water,"-1":house,"-2":road,2:factory,3:farm,6:TownHall,7:Mine,4:ware,5:wind1,5.1:wind2,8:Fisry,9:park,10:baseT,10.1:UpperT};function drawGrid(){for(let t=0;t<16;t++)for(let e=0;e<32;e++){let n=16*e,o=16*t,s=cityData[t][e];if(buildingImages.hasOwnProperty(s)){let a=buildingImages[s];ctx.drawImage(a,n,o,16,16)}}}function gameLoop(){drawGrid(),setTimeout(requestAnimationFrame(gameLoop),3e4)}function loadOnce(){if(!1===loadone)for(let t=0;t<16;t++)for(let e=0;e<32;e++)if(0===t||15===t||0===e||31===e).3>Math.random()&&(cityData[t][e]=1,t>0&&(cityData[t-1][e]=1),t<15&&(cityData[t+1][e]=1),e>0&&(cityData[t][e-1]=1),e<31&&(cityData[t][e+1]=1));else{let n=.5>Math.random()?grass2:grass;n===grass2?cityData[t][e]=.5:cityData[t][e]=0}cityData[8][0]=cityData[8][1]=-2,loadone=!0}loadOnce(),gameLoop();let list=["Destroy"," ","Factory","Farm","Warehouse","Windmill","Townhall","Mine","Fishery","Park","Trishul"];const selectedbuid=document.getElementById("selectedbuild"),sidebarButtons=document.querySelectorAll(".sidebar-button");sidebarButtons.forEach(t=>{t.addEventListener("click",()=>{if(-1===(selectedBuildingIndex=parseInt(t.getAttribute("data-building-index"))))selectedbuid.innerHTML="House";else if(-2===selectedBuildingIndex)selectedbuid.innerHTML="Road";else try{selectedbuid.innerText=list[selectedBuildingIndex]}catch(e){}})}),canvas.addEventListener("click",t=>{let e=canvas.getBoundingClientRect(),n=t.clientX-e.left-16,o=t.clientY-e.top-16,s={"-1":BuildHouse,"-2":BuildRoad,0:DestroyBuildings,2:BuildFactory,3:BuildFarm,5:BuildWindmill,6:BuildTownHall,7:BuildMine,4:BuildWare,8:BuildFishery,9:BuildPark,10:BuildTrishul},a=Math.floor(n/16),i=Math.floor(o/16);if(console.log(a+" "+i),a>=0&&a<31&&i>=0&&i<15&&s.hasOwnProperty(selectedBuildingIndex)){let r=s[selectedBuildingIndex];r(i,a),coincount.innerHTML=CoinsCurrency}});let msgs=["Requires road nearby or farm and place on grass","Requires road nearby and place on grass","Can be placed only over grass","Can build only one townhall","Can only destroy roads","OR Not enough Coins "];const Bcost=[1,2,0,1,5,2,10,15,20,20,20,50];function BuildFarm(t,e){(-2===cityData[t][e+1]||-2===cityData[t][e-1]||-2===cityData[t+1][e]||-2===cityData[t-1][e]||3===cityData[t][e+1]||3===cityData[t][e-1]||3===cityData[t+1][e]||3===cityData[t-1][e])&&(.5===cityData[t][e]||0===cityData[t][e])&&CoinsCurrency>Bcost[3]-1?(cityData[t][e]=3,CoinsCurrency-=Bcost[3],CheckTiles()):alerts.innerText=msgs[0]+" "+msgs[5]}function BuildHouse(t,e){ISconnected(t,e)&&CoinsCurrency>=Bcost[1]?(cityData[t][e]=-1,CoinsCurrency-=Bcost[1],CheckTiles()):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildFactory(t,e){ISconnected(t,e)&&CoinsCurrency>=Bcost[5]?(cityData[t][e]=2,CoinsCurrency-=Bcost[5],CheckTiles()):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildRoad(t,e){-2===cityData[t][e]||1===cityData[t][e]?alerts.innerText=msgs[2]+" "+msgs[5]:cityData[t][e]=-2}function DestroyBuildings(t,e){-1===cityData[t][e]||2===cityData[t][e]?(cityData[t][e]=0,CheckTiles()):alerts.innerText=msgs[4]+" "+msgs[5]}function BuildWindmill(t,e){(ISconnected(t,e)||ISconnected(t-1,e))&&CoinsCurrency>=Bcost[7]&&0===Math.floor(cityData[t-1][e])&&0===Math.floor(cityData[t][e])?(cityData[t-1][e]=5.1,cityData[t][e]=5,CoinsCurrency-=Bcost[7]):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildTownHall(t,e){ISconnected(t,e)&&!1===ISTownhall&&CoinsCurrency>=Bcost[6]?(CoinsCurrency-=Bcost[6],cityData[t][e]=6):alerts.innerText=msgs[3]+" "+msgs[5]}function BuildMine(t,e){ISconnected(t,e)&&CoinsCurrency>=Bcost[8]?(cityData[t][e]=7,CoinsCurrency-=Bcost[8]):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildWare(t,e){ISconnected(t,e)&&CoinsCurrency>=Bcost[4]?(cityData[t][e]=4,CoinsCurrency-=Bcost[4]):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildFishery(t,e){ISconnected(t,e)&&CoinsCurrency>=Bcost[9]&&(1===cityData[t+1][e]||1===cityData[t-1][e]||1===cityData[t][e+1]||1===cityData[t][e-1])?(cityData[t][e]=8,CoinsCurrency-=Bcost[9]):alerts.innerText=msgs[1]+" Around water.  "+msgs[5]}function BuildPark(t,e){0===Math.floor(cityData[t][e])&&CoinsCurrency>=Bcost[10]?(cityData[t][e]=9,CoinsCurrency-=Bcost[10]):alerts.innerText="Only can be placed over grass "+msgs[5]}function BuildTrishul(t,e){(ISconnected(t,e)||ISconnected(t-1,e))&&0===Math.floor(cityData[t-1][e])&&0===Math.floor(cityData[t][e])&&CoinsCurrency>=Bcost[11]?(cityData[t-1][e]=10.1,cityData[t][e]=10,CoinsCurrency-=Bcost[11]):alerts.innerText=msgs[1]+" "+msgs[5]}function ISconnected(t,e){return!!((-2===cityData[t][e+1]||-2===cityData[t][e-1]||-2===cityData[t+1][e]||-2===cityData[t-1][e])&&0===Math.floor(cityData[t][e])&&isConnectedToInitialRoad(t,e))}let No_of=[0,0,0,0,0,0,0];const coincount=document.getElementById("coins"),NoOfPeopleHTML=document.getElementById("people");let ISTownhall=!1,parks=0;function CheckTiles(){No_of=[0,0,0,0,0,0,0],parks=0;for(let t=0;t<16;t++)for(let e=0;e<32;e++)-1===cityData[t][e]?No_of[0]++:2===cityData[t][e]?No_of[1]++:3===cityData[t][e]?No_of[2]++:5===cityData[t][e]?No_of[3]++:6===cityData[t][e]?ISTownhall=!0:7===cityData[t][e]?No_of[4]++:7===cityData[t][e]?No_of[5]++:8===cityData[t][e]?No_of[6]++:9===cityData[t][e]&&parks++;NoOfPeopleHTML.innerHTML=2*No_of[0]}let yrmnth=[1200,0];function yearupdate(){yrmnth[1]++,yrmnth[1]>12&&(yrmnth[0]++,yrmnth[1]=0),yr.innerText=yrmnth[0],mnth.innerText=yrmnth[1]}function giveCoinsPeriodically(){CalPRO(),UpdateTotal(),yearupdate(),coincount.innerHTML=CoinsCurrency,setTimeout(giveCoinsPeriodically,1e4)}function isConnectedToInitialRoad(t,e){let n=Array.from({length:16},()=>Array.from({length:32},()=>!1)),o=[{row:t,col:e}];for(;o.length>0;){let s=o.shift(),a=s.row,i=s.col;if(8===a&&1===i)return!0;n[a][i]=!0;let r=[{row:a-1,col:i},{row:a+1,col:i},{row:a,col:i-1},{row:a,col:i+1},];for(let c of r){let l=c.row,$=c.col;l>=0&&l<16&&$>=0&&$<32&&!n[l][$]&&-2===cityData[l][$]&&(o.push({row:l,col:$}),n[l][$]=!0)}}return!1}giveCoinsPeriodically();const buttons=document.querySelectorAll(".scrbtn");function CalPRO(){let t=0;try{t=Math.floor(2*No_of[0]/(No_of[1]+No_of[2]+No_of[3]+No_of[4]+No_of[5]+No_of[6]))}catch(e){console.log(e)}console.log(" effiecncy = "+t),Op[1]=25*No_of[5];let n=[3,2,6];t>0&&No_of[2]>0&&(Op[0]+=Math.min(6,No_of[2]),console.log("Op0"+Op[0])),t>1&&(unlck[6]||unlck[7]||unlck[8])&&(unlck[6]&&(Op2[6]+=Math.floor(2*No_of[4])),unlck[7]&&(Op2[7]+=Math.floor(2*No_of[4])),unlck[8]&&(Op2[8]+=Math.floor(No_of[4]))),unlck[1]&&t>0&&Op[0]>0&&(Op[0]>No_of[3]?(Op[0]=Op[0]-Math.min(n[2],No_of[3]),Op2[1]=Op2[1]+Math.min(n[2],No_of[3])):(Op[0]=0,Op2[1]=Op2[1]+No_of[3])),unlck[0]&&t>0&&Op[0]>0&&(Op[0]>No_of[1]?(Op[0]=Op[0]-Math.min(n[2],No_of[1]),Op2[0]=Op2[0]+Math.min(n[2],No_of[1])):(Op[0]=0,Op2[0]=Op2[0]+No_of[1])),unlck[3]&&t>1&&Op[0]>0&&(Op[0]>No_of[1]?(Op[0]=Op[0]-Math.min(n[2],No_of[1]),Op2[3]=Op2[3]+Math.min(n[2],No_of[1])):(Op[0]=0,Op2[3]=Op2[3]+No_of[1])),unlck[9]&&t>1&&Op2[7]>0&&Op2[8]>0&&(Op2[7]>No_of[1]&&Op2[8]>No_of[1]?(Op2[7]=Op2[7]-Math.min(n[0],No_of[1]),Op2[8]=Op2[8]-Math.min(n[0],No_of[1]),Op2[9]=Op2[9]+Math.min(n[0],No_of[1])):alerts.innerText="Not enough production of iron and gunpowder"),unlck[10]&&t>1&&Op2[7]>0&&Op2[8]>0&&(Op2[7]>No_of[1]&&Op2[8]>No_of[1]?(Op2[7]=Op2[7]-Math.min(n[1],No_of[1]),Op2[8]=Op2[8]-Math.min(n[1],No_of[1]),Op2[10]=Op2[10]+Math.min(n[1],No_of[1])):alerts.innerText="Not enough production of iron and gunpowder"),No_of[6]>0&&t>0&&unlck[4]&&(Op2[4]+=Math.min(8,No_of[6])),SmmryUD()}function SmmryUD(){var t=["Sugar","Flour","Clothing","Paper","Ink","WoodenArtifacts","Coal","Iron","Gun-Powder","Cannon","Gun"],e=document.createElement("p");console.log(Op2);var n=document.getElementById("summaryElement");n.textContent="";var o=document.createElement("p");o.innerHTML="Raw Materials = "+Op[0],n.appendChild(o);var s=document.createElement("p");s.innerHTML="Storage = "+25*No_of[5],n.appendChild(s);for(var a=0;a<Op2.length;a++){var e=document.createElement("p");e.innerHTML=t[a]+" = "+Op2[a],n.appendChild(e)}}function UpdateTotal(){tsell=0;let t=[2,2,3,3,4,5,1,1,2,3,4];for(var e=0;e<t.length;e++)tsell+=Op2[e]*t[e];tsell+=Op[0],tsellbtn.innerText=tsell}buttons.forEach(t=>{t.addEventListener("click",()=>{let e=parseInt(t.getAttribute("re-index")),n=itemsCosts[e];!1===unlck[e]&&(CoinsCurrency>=n?(CoinsCurrency-=n,coincount.innerHTML=CoinsCurrency,unlck[e]=!0,t.classList.add("scr")):alerts.innerText="Not enough coins to unlock this item!")})}),sellAllButton.addEventListener("click",function(){CoinsCurrency+=tsell,tsell=0,coincount.innerHTML=CoinsCurrency,tsellbtn.innerText=tsell,Op2=[0,0,0,0,0,0,0,0,0,0,0],Op[0]=0,SmmryUD()});