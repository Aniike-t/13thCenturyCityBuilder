const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),coincount=document.getElementById("coins"),NoOfPeopleHTML=document.getElementById("people"),numRows=20,numCols=40,tileWidth=25.6,tileHeight=25.6;let loadone=!1,selectedBuildingIndex=-1;const alerts=document.getElementById("altmsg");let stuse=0,unlck=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];const itemsCosts=[15,20,25,30,40,60,10,20,30,40,60,25,100,100];let Op=[0,0],Op2=[0,0,0,0,0,0,0,0,0,0,0],CoinsCurrency=1e4;const yr=document.getElementById("yr"),mnth=document.getElementById("mnth");let tsell=0;const sellAllButton=document.getElementById("sellall"),tsellbtn=document.getElementById("tsell"),cityData=Array.from({length:20},()=>Array.from({length:40},()=>0));function createImage(e){let t=new Image;return t.src=e,t}const water=createImage("assets/water.jpg"),grass=createImage("assets/grass.jpg"),grass2=createImage("assets/grass2.png"),house=createImage("assets/house.png"),road=createImage("assets/road.png"),factory=createImage("assets/factory.png"),farm=createImage("assets/farm.jpg"),wind1=createImage("assets/wind1.png"),wind2=createImage("assets/wind2.png"),TownHall=createImage("assets/TownHall.png"),Mine=createImage("assets/mine.png"),ware=createImage("assets/warehouse.png"),Fisry=createImage("assets/fishery.png"),park=createImage("assets/park.png"),baseT=createImage("assets/wdc1.png"),UpperT=createImage("assets/wdc2.png"),swrdd=createImage("assets/swrdd.png"),swrdu=createImage("assets/swrdu.png"),left=createImage("assets/left.png"),right=createImage("assets/right.png"),buildingImages={0:grass,.5:grass2,1:water,"-1":house,"-2":road,2:factory,3:farm,6:TownHall,7:Mine,4:ware,5:wind1,5.1:wind2,8:Fisry,9:park,10:baseT,10.1:UpperT,11:swrdd,11.1:swrdu,12:left,12.1:right};function drawGrid(){for(let e=0;e<20;e++)for(let t=0;t<40;t++){let n=25.6*t,o=25.6*e,a=cityData[e][t];if(buildingImages.hasOwnProperty(a)){let s=buildingImages[a];ctx.drawImage(s,n,o,25.6,25.6)}}}function gameLoop(){drawGrid(),requestAnimationFrame(gameLoop)}function loadOnce(){if(!1===loadone)for(let e=0;e<20;e++)for(let t=0;t<40;t++)if(0===e||19===e||0===t||39===t).3>Math.random()&&(cityData[e][t]=1,e>0&&(cityData[e-1][t]=1),e<19&&(cityData[e+1][t]=1),t>0&&(cityData[e][t-1]=1),t<39&&(cityData[e][t+1]=1));else{let n=.5>Math.random()?grass2:grass;n===grass2?cityData[e][t]=.5:cityData[e][t]=0}cityData[8][0]=cityData[8][1]=-2,loadone=!0}loadOnce(),gameLoop();let list=["Destroy"," ","Factory","Farm","Warehouse","Windmill","Townhall","Mine","Fishery","Park","Wood Cutter"];const selectedbuid=document.getElementById("selectedbuild"),sidebarButtons=document.querySelectorAll(".sidebar-button");sidebarButtons.forEach(e=>{e.addEventListener("click",()=>{if(-1===(selectedBuildingIndex=parseInt(e.getAttribute("data-building-index"))))selectedbuid.innerHTML="House";else if(-2===selectedBuildingIndex)selectedbuid.innerHTML="Road";else try{selectedbuid.innerText=list[selectedBuildingIndex]}catch(t){}})}),canvas.addEventListener("click",e=>{let t=canvas.getBoundingClientRect(),n=e.clientX-t.left-25.6,o=e.clientY-t.top-25.6,a={"-1":BuildHouse,"-2":BuildRoad,2:BuildFactory,3:BuildFarm,5:BuildWindmill,6:BuildTownHall,7:BuildMine,4:BuildWare,8:BuildFishery,9:BuildPark,10:BuildWDC,11:BSword},s=Math.floor(n/25.6),r=Math.floor(o/25.6);if(s>=0&&s<39&&r>=0&&r<19&&a.hasOwnProperty(selectedBuildingIndex)){let i=a[selectedBuildingIndex];i(r,s),coincount.innerHTML=CoinsCurrency}});let msgs=["Requires road nearby or farm and place on grass","Requires road nearby and place on grass","Can be placed only over grass","Can build only one townhall","Can only destroy roads","OR Not enough Coins "];const Bcost=[1,2,0,1,5,2,10,25,50,75,100,150,200];let No_of=[0,0,0,0,0,0,0,0,0];function BuildFarm(e,t){(-2===cityData[e][t+1]||-2===cityData[e][t-1]||-2===cityData[e+1][t]||-2===cityData[e-1][t]||3===cityData[e][t+1]||3===cityData[e][t-1]||3===cityData[e+1][t]||3===cityData[e-1][t])&&(.5===cityData[e][t]||0===cityData[e][t])&&CoinsCurrency>Bcost[3]-1?(cityData[e][t]=3,CoinsCurrency-=Bcost[3],No_of[2]++):alerts.innerText=msgs[0]+" "+msgs[5]}function BuildHouse(e,t){ISconnected(e,t)&&CoinsCurrency>=Bcost[1]?(cityData[e][t]=-1,CoinsCurrency-=Bcost[1],No_of[0]++,-1===cityData[e][t+1]?(cityData[e][t]=12,cityData[e][t+1]=12.1,No_of[0]+=2):-1===cityData[e][t-1]&&(cityData[e][t-1]=12,cityData[e][t]=12.1,No_of[0]+=2),NoOfPeopleHTML.innerHTML=2*No_of[0]):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildFactory(e,t){ISconnected(e,t)&&CoinsCurrency>=Bcost[5]?(cityData[e][t]=2,CoinsCurrency-=Bcost[5],No_of[1]++):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildRoad(e,t){-2===cityData[e][t]||1===cityData[e][t]?alerts.innerText=msgs[2]+" "+msgs[5]:cityData[e][t]=-2}function BuildWindmill(e,t){(ISconnected(e,t)||ISconnected(e-1,t))&&CoinsCurrency>=Bcost[7]&&0===Math.floor(cityData[e-1][t])&&0===Math.floor(cityData[e][t])?(cityData[e-1][t]=5.1,cityData[e][t]=5,CoinsCurrency-=Bcost[7],No_of[3]++):alerts.innerText=msgs[1]+" "+msgs[5]}function BSword(e,t){(ISconnected(e,t)||ISconnected(e-1,t))&&CoinsCurrency>=Bcost[12]&&0===Math.floor(cityData[e-1][t])&&0===Math.floor(cityData[e][t])?(cityData[e-1][t]=11.1,cityData[e][t]=11,CoinsCurrency-=Bcost[12]):alerts.innerText=msgs[1]+" "+msgs[5]}let ISTownhall=!1;function BuildTownHall(e,t){ISconnected(e,t)&&!1===ISTownhall&&CoinsCurrency>=Bcost[6]?(ISTownhall=!0,CoinsCurrency-=Bcost[6],cityData[e][t]=6):alerts.innerText=msgs[3]+" "+msgs[5]}function BuildMine(e,t){ISconnected(e,t)&&CoinsCurrency>=Bcost[8]?(cityData[e][t]=7,CoinsCurrency-=Bcost[8],No_of[4]++):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildWare(e,t){ISconnected(e,t)&&CoinsCurrency>=Bcost[4]?(cityData[e][t]=4,CoinsCurrency-=Bcost[4],No_of[5]++):alerts.innerText=msgs[1]+" "+msgs[5]}function BuildFishery(e,t){ISconnected(e,t)&&CoinsCurrency>=Bcost[9]&&(1===cityData[e+1][t]||1===cityData[e-1][t]||1===cityData[e][t+1]||1===cityData[e][t-1])?(cityData[e][t]=8,CoinsCurrency-=Bcost[9],No_of[6]++):alerts.innerText=msgs[1]+" Around water.  "+msgs[5]}function BuildPark(e,t){0===Math.floor(cityData[e][t])&&CoinsCurrency>=Bcost[10]?(cityData[e][t]=9,CoinsCurrency-=Bcost[10],No_of[8]++):alerts.innerText="Only can be placed over grass "+msgs[5]}function BuildWDC(e,t){(ISconnected(e,t)||ISconnected(e-1,t))&&0===Math.floor(cityData[e-1][t])&&0===Math.floor(cityData[e][t])&&CoinsCurrency>=Bcost[11]?(cityData[e-1][t]=10.1,cityData[e][t]=10,CoinsCurrency-=Bcost[11],No_of[7]++):alerts.innerText=msgs[1]+" "+msgs[5]}function ISconnected(e,t){return!!((-2===cityData[e][t+1]||-2===cityData[e][t-1]||-2===cityData[e+1][t]||-2===cityData[e-1][t])&&0===Math.floor(cityData[e][t])&&isConnectedToInitialRoad(e,t))}let yrmnth=[1200,0];function yearupdate(){yrmnth[1]+=6,yrmnth[1]>12&&(yrmnth[0]++,yrmnth[1]=0),yr.innerText=yrmnth[0],mnth.innerText=yrmnth[1]}function giveCoinsPeriodically(){CalPRO(),UpdateTotal(),yearupdate(),coincount.innerHTML=CoinsCurrency,setTimeout(giveCoinsPeriodically,1e4)}function isConnectedToInitialRoad(e,t){let n=Array.from({length:20},()=>Array.from({length:40},()=>!1)),o=[{row:e,col:t}];for(;o.length>0;){let a=o.shift(),s=a.row,r=a.col;if(8===s&&1===r)return!0;n[s][r]=!0;let i=[{row:s-1,col:r},{row:s+1,col:r},{row:s,col:r-1},{row:s,col:r+1},];for(let c of i){let l=c.row,$=c.col;l>=0&&l<20&&$>=0&&$<40&&!n[l][$]&&-2===cityData[l][$]&&(o.push({row:l,col:$}),n[l][$]=!0)}}return!1}coincount.innerHTML=CoinsCurrency,giveCoinsPeriodically();const buttons=document.querySelectorAll(".scrbtn");function CalPRO(){let e=0;try{e=Math.floor(2*No_of[0]/(No_of[1]+No_of[2]+No_of[3]+No_of[4]+No_of[5]+No_of[6]+No_of[7]))}catch(t){}Op[1]=25+25*No_of[5];let n=[3,2,6];if(stuse<Op[1]){if(e>0&&No_of[2]>0&&(Op[0]+=Math.min(6,No_of[2]),No_of[2]-6>0&&(Op[0]+=Math.floor(No_of[2]*(1/40)))),e>0&&(unlck[6]||unlck[7]||unlck[8])){let o=Math.min(e,2);unlck[6]&&(Op2[6]+=No_of[4]*o),unlck[7]&&(Op2[7]+=No_of[4]*o),unlck[8]&&(Op2[8]+=No_of[4]/2*o)}if(e>0&&unlck[5]&&No_of[7]>0){let a=Math.min(e,2);Op2[5]+=No_of[7]*a}unlck[1]&&e>0&&Op[0]>0&&(Op[0]>No_of[3]?(Op[0]=Op[0]-Math.min(n[2],No_of[3]),Op2[1]=Op2[1]+Math.min(n[2],No_of[3])):(Op[0]=0,Op2[1]=Op2[1]+No_of[3])),unlck[0]&&e>0&&Op[0]>0&&(Op[0]>No_of[1]?(Op[0]=Op[0]-Math.min(n[2],No_of[1]),Op2[0]=Op2[0]+Math.min(n[2],No_of[1])):(Op[0]=0,Op2[0]=Op2[0]+No_of[1])),unlck[3]&&e>1&&Op[0]>0&&(Op[0]>No_of[1]?(Op[0]=Op[0]-Math.min(n[2],No_of[1]),Op2[3]=Op2[3]+Math.min(n[2],No_of[1])):(Op[0]=0,Op2[3]=Op2[3]+No_of[1])),unlck[9]&&e>1&&Op2[7]>0&&Op2[8]>0&&(Op2[7]>No_of[1]&&Op2[8]>No_of[1]?(Op2[7]=Op2[7]-Math.min(n[0],No_of[1]),Op2[8]=Op2[8]-Math.min(n[0],No_of[1]),Op2[9]=Op2[9]+Math.min(n[0],No_of[1])):alerts.innerText="Not enough manpower and production of iron and gunpowder"),unlck[10]&&e>1&&Op2[7]>0&&Op2[8]>0&&(Op2[7]>No_of[1]&&Op2[8]>No_of[1]?(Op2[7]=Op2[7]-Math.min(n[1],No_of[1]),Op2[8]=Op2[8]-Math.min(n[1],No_of[1]),Op2[10]=Op2[10]+Math.min(n[1],No_of[1])):alerts.innerText="Not enough manpower and production of iron and gunpowder"),No_of[6]>0&&e>0&&unlck[4]&&(Op2[4]+=Math.min(8,No_of[6]))}else alerts.innerText="Not enough storage";for(var s=0;s<Op2.length;s++)stuse+=Op2[s];stuse+=Op[0],SmmryUD()}function SmmryUD(){var e=["Sugar","Flour","Clothing","Paper","Ink","WoodenArtifacts","Coal","Iron","Gun-Powder","Cannon","Gun"],t=document.createElement("p"),n=document.getElementById("summaryElement");n.textContent="";var o=document.createElement("p");o.innerHTML="Raw Materials = "+Op[0],n.appendChild(o);var a=document.createElement("p");console.log(25*No_of[5]),a.innerHTML="Storage = "+stuse+"/"+(25+25*No_of[5]),n.appendChild(a);for(var s=0;s<Op2.length;s++){var t=document.createElement("p");t.innerHTML=e[s]+" = "+Op2[s],n.appendChild(t)}}function UpdateTotal(){tsell=0;let e=[2,2,3,3,4,5,1,1,2,3,4];for(var t=0;t<e.length;t++)tsell+=Op2[t]*e[t];tsell+=Op[0],unlck[11]?tsell+=Math.floor(10*tsell/100):unlck[12]&&(tsell+=Math.floor(15*tsell/100)),tsellbtn.innerText=tsell}buttons.forEach(e=>{e.addEventListener("click",()=>{let t=parseInt(e.getAttribute("re-index")),n=itemsCosts[t];!1===unlck[t]&&(CoinsCurrency>=n?(CoinsCurrency-=n,coincount.innerHTML=CoinsCurrency,unlck[t]=!0,e.classList.add("scr")):alerts.innerText="Not enough coins to unlock this item!")})}),sellAllButton.addEventListener("click",function(){CoinsCurrency+=tsell,tsell=0,stuse=0,coincount.innerHTML=CoinsCurrency,tsellbtn.innerText=tsell,Op2=[0,0,0,0,0,0,0,0,0,0,0],Op[0]=0,SmmryUD()});